import { Injectable, OnDestroy } from '@angular/core';

import { FTWeb3Service } from '../FTServices/ft-web3';
import { FTObserver } from '../FTFramework/FT-Observer';
import { FTSession } from '../FTFramework/FT-Session';
import { FTHttpClient } from '../FTFramework/FT-HttpClient';
import { FTCache } from '../FTFramework/FT-Cache';

@Injectable()

export class FTTokenWatchService {

  private ERC20ABI = [{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"gotFree","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalOutstanding","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"getFreeToken","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"author","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"}],"name":"unapprove","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"}];
  private EtherABI = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x06fdde03"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x095ea7b3"},{"constant":true,"inputs":[],"name":"exportEscrow","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x1258c621"},{"constant":true,"inputs":[],"name":"totalOutstanding","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x16078d04"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x18160ddd"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x23b872dd"},{"constant":true,"inputs":[],"name":"change","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x2ee79ded"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x313ce567"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x70a08231"},{"constant":false,"inputs":[{"name":"_to","type":"address"}],"name":"transferAdmin","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x75829def"},{"constant":false,"inputs":[{"name":"_cryptoAddressFrom","type":"address"},{"name":"_cryptoAddressTo","type":"address"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"moveCryptoOut","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x7dbc265a"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x95d89b41"},{"constant":false,"inputs":[{"name":"_cryptoAddressTo","type":"address"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"moveCryptoOutFromChange","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x9a0de5fe"},{"constant":true,"inputs":[],"name":"fees","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x9af1d35a"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"uint256"}],"name":"preventDuplicates","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x9cd6fa9f"},{"constant":true,"inputs":[],"name":"totalEscrow","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xa3d89844"},{"constant":false,"inputs":[{"name":"_cryptoAddressFrom","type":"address"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"moveCryptoToChange","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa4ed25b9"},{"constant":true,"inputs":[],"name":"author","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xa6c3e6b9"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa9059cbb"},{"constant":false,"inputs":[{"name":"_cryptoAddress","type":"address"},{"name":"_fttAddress","type":"address"}],"name":"createCryptoAddress","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xbc9ee237"},{"constant":false,"inputs":[{"name":"_cryptoAddress","type":"address"},{"name":"_value","type":"uint256"}],"name":"export","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xc052f888"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"cryptoAddressReceiver","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xc1375931"},{"constant":true,"inputs":[],"name":"coveredFees","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xc8973556"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xcae9ca51"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xdd62ed3e"},{"constant":false,"inputs":[{"name":"_feesToPay","type":"uint256"},{"name":"_cryptoAddressFrom","type":"address"},{"name":"_fee","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"}],"name":"payFees","outputs":[{"name":"succes_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xebb29e91"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xf851a440"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"cryptoAddressBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xfa58bfb7"},{"constant":false,"inputs":[{"name":"_spender","type":"address"}],"name":"unapprove","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xfbf1f78a"},{"constant":false,"inputs":[{"name":"_fromCryptoAddress","type":"address"},{"name":"_cryptoAddress","type":"address"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"receive","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xfe35319a"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor","signature":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event","signature":"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event","signature":"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":true,"name":"blockNumber","type":"uint256"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"CryptoChange","type":"event","signature":"0xf814aa3f2a070fb35e9ec8d5b87a062784c4ec9a74ba22d6ba26a4eaddce7716"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":true,"name":"blockNumber","type":"uint256"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"CryptoExternalChange","type":"event","signature":"0x7a3d13eb64d202fdc227df6e366c6013c574615612d51fef0f343125045cc68d"},{"anonymous":false,"inputs":[{"indexed":true,"name":"cryptoAddress","type":"address"},{"indexed":true,"name":"sender","type":"address"},{"indexed":true,"name":"mNow","type":"uint256"},{"indexed":false,"name":"value","type":"uint256"}],"name":"SendToAddress","type":"event","signature":"0xeae2c16ea51acf1314b3799e81c82f6fd19d5006d14df45aca5b5db2df695a75"}];
  private BitCoinABI = [{"constant":false,"inputs":[{"name":"_cryptoAddress","type":"string"},{"name":"_value","type":"uint256"}],"name":"export","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x05d4c489"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x06fdde03"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x095ea7b3"},{"constant":true,"inputs":[],"name":"exportEscrow","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x1258c621"},{"constant":true,"inputs":[],"name":"totalOutstanding","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x16078d04"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x18160ddd"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x23b872dd"},{"constant":true,"inputs":[],"name":"change","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x2ee79ded"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x313ce567"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"cryptoAddressReceiver","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x577bbd2d"},{"constant":true,"inputs":[{"name":"getHash","type":"string"}],"name":"getK","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"pure","type":"function","signature":"0x65c9b789"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x70a08231"},{"constant":false,"inputs":[{"name":"_cryptoAddressFrom","type":"string"},{"name":"_cryptoAddressTo","type":"string"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"moveCryptoOut","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x74701503"},{"constant":false,"inputs":[{"name":"_to","type":"address"}],"name":"transferAdmin","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x75829def"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x95d89b41"},{"constant":true,"inputs":[],"name":"fees","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x9af1d35a"},{"constant":true,"inputs":[],"name":"totalEscrow","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xa3d89844"},{"constant":true,"inputs":[],"name":"author","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xa6c3e6b9"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa9059cbb"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"cryptoAddressBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xb8f42a84"},{"constant":true,"inputs":[],"name":"coveredFees","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xc8973556"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_extraData","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xcae9ca51"},{"constant":false,"inputs":[{"name":"_fromCryptoAddress","type":"string"},{"name":"_cryptoAddress","type":"string"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"receive","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xd2f33e0a"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"}],"name":"preventDuplicates","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xd5fdb6ab"},{"constant":false,"inputs":[{"name":"_cryptoAddressFrom","type":"string"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"moveCryptoToChange","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xd8ae6128"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xdd62ed3e"},{"constant":false,"inputs":[{"name":"_feesToPay","type":"uint256"},{"name":"_cryptoAddressFrom","type":"string"},{"name":"_fee","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"}],"name":"payFees","outputs":[{"name":"succes_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xf73b161f"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xf851a440"},{"constant":false,"inputs":[{"name":"_spender","type":"address"}],"name":"unapprove","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xfbf1f78a"},{"constant":false,"inputs":[{"name":"_cryptoAddressTo","type":"string"},{"name":"_value","type":"uint256"},{"name":"_cryptoBlockNumber","type":"uint256"},{"name":"_fee","type":"uint256"}],"name":"moveCryptoOutFromChange","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xff25c64b"},{"constant":false,"inputs":[{"name":"_cryptoAddress","type":"string"},{"name":"_fttAddress","type":"address"}],"name":"createCryptoAddress","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xff8f4390"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor","signature":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event","signature":"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event","signature":"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"string"},{"indexed":true,"name":"to","type":"string"},{"indexed":true,"name":"blockNumber","type":"uint256"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"CryptoChange","type":"event","signature":"0x21e02ee972bedbc1ae66e5b6061ba130a0c60e6a9850a07a475a224a23e85681"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"string"},{"indexed":true,"name":"to","type":"string"},{"indexed":true,"name":"blockNumber","type":"uint256"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"CryptoExternalChange","type":"event","signature":"0xf35f6082ed592c3b7a486ac7e94674e2d45b0bc6e7e4fe77f6a73a1461694a51"},{"anonymous":false,"inputs":[{"indexed":true,"name":"cryptoAddress","type":"string"},{"indexed":true,"name":"sender","type":"address"},{"indexed":true,"name":"mNow","type":"uint256"},{"indexed":false,"name":"value","type":"uint256"}],"name":"SendToAddress","type":"event","signature":"0xfc4aed2212873e165fa2e07e0ab61eb93e90c33843e450c479ec419d581fab6b"}];
  private EscrowABI = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x06fdde03"},{"constant":false,"inputs":[{"name":"_newTransactionFee","type":"uint8"},{"name":"_newTransactionFeeMultiple","type":"uint8"},{"name":"_newTransactionFixedFee","type":"uint256"}],"name":"updateFees","outputs":[{"name":"success_","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function","signature":"0x123fcde6"},{"constant":false,"inputs":[{"name":"_hash","type":"bytes32"},{"name":"_token","type":"address"},{"name":"_value","type":"uint256"}],"name":"sendAmount","outputs":[{"name":"success_","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function","signature":"0x2b592622"},{"constant":true,"inputs":[],"name":"transactionFixedFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x47fca313"},{"constant":false,"inputs":[],"name":"freeze","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x62a5af3b"},{"constant":false,"inputs":[{"name":"_token","type":"address"}],"name":"getOwnerBalance","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x7fcf440a"},{"constant":true,"inputs":[],"name":"transactionFee","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x9ed3edf0"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa6f9dae1"},{"constant":false,"inputs":[{"name":"_hash","type":"bytes32"}],"name":"getNeverCached","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xb2caffe5"},{"constant":false,"inputs":[{"name":"_hashKey","type":"string"}],"name":"getAmount","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xe35cf0ca"},{"constant":true,"inputs":[],"name":"transactionFeeMultiple","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xf5fccae2"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor","signature":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mHash","type":"bytes32"},{"indexed":true,"name":"mToken","type":"address"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"HashSent","type":"event","signature":"0xa595818c9d4b46ea72fbf14cb1e6573fcb7eb0722abbb9e16736b461dffb80cd"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mHash","type":"bytes32"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"HashCached","type":"event","signature":"0x99840862eecd61b78ec947ae70419d187baf3c6f89f0bfb5c311b5f0fccaf3cf"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mHash","type":"bytes32"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"HashNeverCached","type":"event","signature":"0xe72702c36317763472847b2ffc1757bd0ffaab814be916bdcf71197aadcc3cfc"},{"anonymous":false,"inputs":[{"indexed":false,"name":"mTransFee","type":"uint8"},{"indexed":false,"name":"mTransmultiple","type":"uint8"},{"indexed":false,"name":"mTransFlatFee","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageChangeFees","type":"event","signature":"0xe422d31ad0a7139b58a00a7ad71cefc619bdf5e99c4698efc980d2414ab0e620"},{"anonymous":false,"inputs":[{"indexed":false,"name":"mFreeze","type":"bool"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageFreeze","type":"event","signature":"0x4acad4a82756afd37e2d2e935cd96aa2d8c97634700f991592f3b977d6dc7d80"}];
  private MarketPlaceABI = [{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x06fdde03"},{"constant":false,"inputs":[{"name":"_newTransactionFee","type":"uint8"},{"name":"_newTransactionFeeMultiple","type":"uint8"},{"name":"_newAddToBookFee","type":"uint256"}],"name":"updateFees","outputs":[{"name":"success_","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function","signature":"0x123fcde6"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_buy","type":"bool"},{"name":"_amount","type":"uint256"},{"name":"_shares","type":"uint256"},{"name":"_startAmount","type":"uint256"}],"name":"makeOffer","outputs":[{"name":"_success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x270b3d2b"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_value","type":"uint256"}],"name":"deposit","outputs":[{"name":"success_","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function","signature":"0x47e7ef24"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"bool"},{"name":"","type":"uint256"}],"name":"offersAtPrice","outputs":[{"name":"nextPrice","type":"uint256"},{"name":"currentOffersLength","type":"uint24"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x51debeef"},{"constant":true,"inputs":[],"name":"addToBookFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x5732c2bb"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_value","type":"uint256"}],"name":"withdrawal","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x5a6b26ba"},{"constant":false,"inputs":[],"name":"freeze","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x62a5af3b"},{"constant":false,"inputs":[{"name":"_token","type":"address"},{"name":"_buy","type":"bool"},{"name":"_amount","type":"uint256"}],"name":"cancelOffer","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x7962d432"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"address"}],"name":"accountBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x887bdcfc"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x8da5cb5b"},{"constant":false,"inputs":[{"name":"_grantor","type":"address"},{"name":"_value","type":"uint256"},{"name":"_from","type":"address"},{"name":"_extraData","type":"bytes"}],"name":"receiveApproval","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x8f4ffcb1"},{"constant":true,"inputs":[],"name":"transactionFee","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x9ed3edf0"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[{"name":"success_","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa6f9dae1"},{"constant":true,"inputs":[],"name":"bidDecimal","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xb04cf4d5"},{"constant":true,"inputs":[],"name":"transactionFeeMultiple","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xf5fccae2"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor","signature":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mToken","type":"address"},{"indexed":true,"name":"mAccount","type":"address"},{"indexed":false,"name":"mValue","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageAccountDeposit","type":"event","signature":"0x88c55a25c2ff316c8b3eca41653bb7eed1998d61e2f7f7288b79123faba99029"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mToken","type":"address"},{"indexed":true,"name":"mAccount","type":"address"},{"indexed":false,"name":"mValue","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageAccountWithdrawal","type":"event","signature":"0x62185ef12fb4703a4f6e507e425ecaf63765a462d2a690b68015efff74d56323"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mToken","type":"address"},{"indexed":true,"name":"mFromAccount","type":"address"},{"indexed":true,"name":"mToAccount","type":"address"},{"indexed":false,"name":"mPrice","type":"uint256"},{"indexed":false,"name":"mCount","type":"uint256"},{"indexed":false,"name":"mSellerFee","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageTransaction","type":"event","signature":"0x34c71b74d4282956a51d34ef305cd4be32bce34f5b12dbc08a072855c54a08af"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mToken","type":"address"},{"indexed":true,"name":"mFromAccount","type":"address"},{"indexed":false,"name":"mCount","type":"uint256"},{"indexed":false,"name":"mSellerFee","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessagePayTransactionFee","type":"event","signature":"0xb5a03edd954b80022e769f7c8af9170e2e39a4b351002a1864e888aac1eb0f53"},{"anonymous":false,"inputs":[{"indexed":true,"name":"mToken","type":"address"},{"indexed":true,"name":"mBuy","type":"bool"},{"indexed":true,"name":"mAccount","type":"address"},{"indexed":false,"name":"mAddLiquidity","type":"bool"},{"indexed":false,"name":"mPrice","type":"uint256"},{"indexed":false,"name":"mCount","type":"uint256"},{"indexed":false,"name":"mFee","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageOffer","type":"event","signature":"0x15d58562a65ae36bd23629b8f65e2ad443fa78099ce2a35f40d3eac772245b60"},{"anonymous":false,"inputs":[{"indexed":false,"name":"mTransFee","type":"uint8"},{"indexed":false,"name":"mTransmultiple","type":"uint8"},{"indexed":false,"name":"mBookFee","type":"uint256"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageChangeFees","type":"event","signature":"0xe422d31ad0a7139b58a00a7ad71cefc619bdf5e99c4698efc980d2414ab0e620"},{"anonymous":false,"inputs":[{"indexed":false,"name":"mOwner","type":"address"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageOwner","type":"event","signature":"0x399c8ba6436ea2d88f2a7f279f1701397fcd5bd2046ffd92cfa3b4fe16b551cf"},{"anonymous":false,"inputs":[{"indexed":false,"name":"mFreeze","type":"bool"},{"indexed":false,"name":"mNow","type":"uint256"}],"name":"MessageFreeze","type":"event","signature":"0x4acad4a82756afd37e2d2e935cd96aa2d8c97634700f991592f3b977d6dc7d80"}];
  TokenWatch:any[] = [];
  myContracts:any[] = [];
  /*
  address, name, contract, abi, mine, mineTrade, subscribeBook, buyMap, sellMap, subscribeTrades, lastPrice, lastCount, tradeMap, myTradesMap
  */

  constructor ( private cache: FTCache, private ftweb3: FTWeb3Service, private obs: FTObserver, private http: FTHttpClient, private session:FTSession ) { 
    //ToDo: Be better to look up name/ABI from AWS
    //ToDo: Should have token type (Main, Created, Watch)
    this.addTokenToWatch('0xDaC15B2fc7a0fE5833072073C727A8Cc3FC289b5', 'Ethereum', this.EtherABI);
    this.addTokenToWatch('0x0457375dd88352eb54de851db7d0ce775c9758ad', 'Bitcoin', this.BitCoinABI);
    if(this.cache.getCache('encrypted_id').address == '4153547d9fe208d97adc122d156b7605bfb68497'){
      this.addTokenToWatch('0x5dA0448e07bD2fC17115b006dbA3A26D130e139b', 'EscrowSend', this.EscrowABI);
      this.addTokenToWatch('0x91a917d6761B8c634CfE575B8285085834752CF9', 'MarketPlace', this.MarketPlaceABI);
    }
    //this.addTokenToWatch('0x2d5e86187855CC29B40469e8a7355f3fDBf4C088', 'TradeToken', this.ERC20ABI);
    //this.addTokenToWatch('0x9287bb21719d283CfdD7d644a89E8492f9845B64', 'FreeToken', this.ERC20ABI);



    this.obs.getObserver('isSignedIn').subscribe( (data) => {
      if(data == true) {
          let token = this.session.getItem('token');
          let account = this.session.getItem('account');
          if(token && account)
              this.http.put("publishContract", JSON.stringify({
                  "token" : token,
                  "address": account
                  })).toPromise()
              .then( data => {
                  if(data) {
                      try{
                          data = JSON.parse(data).sort(function(a, b){return a.ContractNameVer - b.ContractNameVer});
                          data.forEach(element => {
                              this.addTokenToWatch(element.PublishedAddress, element.ContractNameVer,JSON.parse(element.ContractABI));
                          });
                      }
                      catch {}
                      this.myContracts = data;
                  }
              })
              .catch( err => {console.log(err);});
      }
    });
  }

  ngOnDestroy(): void {
  }

  addTokenToWatch(address, name, ABI) {
    if(this.getTokenIndexByAddress(address==-1)) {
      let contract: any = this.ftweb3.createContractInterface(ABI, address.substring(2));
      let token:any = {address:address, name:name, contract:contract, abi:ABI, mine:'0', mineTrade:'0', buyMap:{}, sellMap:{}, tradeMap:{}, myTradesMap:{}, lastPrice:'0', lastCount:'0' };
      this.TokenWatch.push(token);
    }
  }

  getTokenIndexByAddress(address) {
    return this.TokenWatch.findIndex(x => x.address === address);
  }

}
